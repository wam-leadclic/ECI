<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <assignments>
        <description>Como no quiere aceptar la oportunidad o quiere planificar la llamada, marcamos este interés como exluido</description>
        <name>MarcaInteresExlucido</name>
        <label>MarcaInteresExlucido</label>
        <locationX>740</locationX>
        <locationY>2678</locationY>
        <assignmentItems>
            <assignToReference>InteresExcluido</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>OpportunityVariable.Id</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <assignments>
        <description>Marca la variable de PlanificarLlamada para que el flujo superior controle que se debe pasar por la planificación</description>
        <name>MarcaPlanificarLlamada</name>
        <label>MarcaPlanificarLlamada</label>
        <locationX>578</locationX>
        <locationY>998</locationY>
        <assignmentItems>
            <assignToReference>PlanificarLlamada</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SetMostrarIntereses</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>OpportunityToLost</name>
        <label>Opportunity to lost</label>
        <locationX>1359</locationX>
        <locationY>878</locationY>
        <assignmentItems>
            <assignToReference>OpportunityVariable.StageName</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Perdido</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>OpportunityVariable.Loss_Reason__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Formula_MotivoPerdidaPicklistResultado</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_EstaEmailRelleno</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Asignamos al contacto el nuevo email</description>
        <name>Set_Email</name>
        <label>Set_Email</label>
        <locationX>1546</locationX>
        <locationY>1718</locationY>
        <assignmentItems>
            <assignToReference>Recuperamos_el_Contact.Email</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>screenContactEmail.value</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>ActualizamosContacto</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Asignamos true a la variable para mostrar el mensaje de error para email duplicado</description>
        <name>Set_MostrarErrorEmailDuplicadoTrue</name>
        <label>Set_MostrarErrorEmailDuplicadoTrue</label>
        <locationX>1282</locationX>
        <locationY>1718</locationY>
        <assignmentItems>
            <assignToReference>Var_MostrarErrorEmailDuplicado</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_MostrarErrorValidacion</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>InsuranceHire</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Asignamos true a la variable mostrar error email validacion para que muestre el mensaje de error y reasignamos al campo email en el screen el valor introducido</description>
        <name>Set_MostrarErrorEmailValidacionTrue</name>
        <label>Set_MostrarErrorEmailValidacionTrue</label>
        <locationX>1810</locationX>
        <locationY>1358</locationY>
        <assignmentItems>
            <assignToReference>Var_MostrarErrorValidacion</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_MostrarErrorEmailDuplicado</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>InsuranceHire</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Marca la variable de PlanificarLlamada para que el flujo superior controle que se debe pasar por la planificación</description>
        <name>Set_PlanificarLlamada</name>
        <label>Set Planificar Llamada</label>
        <locationX>842</locationX>
        <locationY>998</locationY>
        <assignmentItems>
            <assignToReference>PlanificarLlamada</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>UpdateOpportunity</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Almacenamos los valores introducidos en el screen</description>
        <name>Set_VariablesEntrada</name>
        <label>Set_Variables de Entrada</label>
        <locationX>1612</locationX>
        <locationY>1118</locationY>
        <assignmentItems>
            <assignToReference>Var_EntradaEmail</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>screenContactEmail.value</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_EntradaLLamarOtroMomento</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>PreguntaQuiereLlamadaEnOtroMomento</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_EntradaInsuranceHireQuestion</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>InsuranceHireQuestion</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>Var_EntradaMotivoPerdida</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Formula_MotivoPerdidaPicklistResultado</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Decision_EmailValido</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>SetMostrarIntereses</name>
        <label>Set MostrarIntereses</label>
        <locationX>740</locationX>
        <locationY>2558</locationY>
        <assignmentItems>
            <assignToReference>MostrarIntereses</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>MarcaInteresExlucido</targetReference>
        </connector>
    </assignments>
    <choices>
        <name>No</name>
        <choiceText>No</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>No</stringValue>
        </value>
    </choices>
    <choices>
        <name>Yes</name>
        <choiceText>Sí</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Si</stringValue>
        </value>
    </choices>
    <decisions>
        <name>CloseOppDecision</name>
        <label>Close Opportunity Decision</label>
        <locationX>380</locationX>
        <locationY>758</locationY>
        <defaultConnector>
            <targetReference>PlanificacionLlamada</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesCloseOppDecision</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CloseOppQuestion</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Yes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>EmailSentDecision</targetReference>
            </connector>
            <label>Sí</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprobamos que el email tiene un formato válido</description>
        <name>Decision_EmailValido</name>
        <label>Decision_EmailValido</label>
        <locationX>1612</locationX>
        <locationY>1238</locationY>
        <defaultConnector>
            <targetReference>Set_MostrarErrorEmailValidacionTrue</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>EmailValido_No</defaultConnectorLabel>
        <rules>
            <name>EmailValido_Si</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Formula_ValidarEmail</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>screenContactEmail.value</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_ContactosDuplicados</targetReference>
            </connector>
            <label>EmailValido_Si</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprobamos si el email está informado.</description>
        <name>Decision_EstaEmailRelleno</name>
        <label>Decision_EstaEmailRelleno?</label>
        <locationX>1359</locationX>
        <locationY>998</locationY>
        <defaultConnector>
            <targetReference>Set_VariablesEntrada</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>EstaEmailRelleno?_No</defaultConnectorLabel>
        <rules>
            <name>EstaEmailRelleno_Si</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Recuperamos_el_Contact.Email</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UpdateOpportunity</targetReference>
            </connector>
            <label>EstaEmailRelleno?_Si</label>
        </rules>
    </decisions>
    <decisions>
        <description>Comprobamos si ya existe algún registro con el email introducido</description>
        <name>Decision_Hay_duplicados</name>
        <label>Decision_¿Hay duplicados?</label>
        <locationX>1414</locationX>
        <locationY>1598</locationY>
        <defaultConnector>
            <targetReference>Set_Email</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>¿Hay duplicados?_No</defaultConnectorLabel>
        <rules>
            <name>Hay_duplicados_Si</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>Get_ContactosDuplicados</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_LeadsDuplicados</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_MostrarErrorEmailDuplicadoTrue</targetReference>
            </connector>
            <label>¿Hay duplicados?_Si</label>
        </rules>
    </decisions>
    <decisions>
        <description>Si ha indicado que quiere que se le llame en otro momento marcamos la planificación de llamada y aplazamos la oportunidad</description>
        <name>Decision_QuiereLlamadaEnOtroMomento</name>
        <label>¿Quiere llamada en otro momento?</label>
        <locationX>1100</locationX>
        <locationY>758</locationY>
        <defaultConnector>
            <targetReference>OpportunityToLost</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>QuiereLlamadaEnOtroMomento_Si</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>PreguntaQuiereLlamadaEnOtroMomento</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Yes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Argumentario_Subflow_OppMotivoAplazamiento</targetReference>
            </connector>
            <label>Si</label>
        </rules>
    </decisions>
    <decisions>
        <description>Si ha marcado ha enviado correo o no</description>
        <name>EmailSentDecision</name>
        <label>¿Ha enviado correo?</label>
        <locationX>182</locationX>
        <locationY>878</locationY>
        <defaultConnector>
            <targetReference>PantallaAvisoPresupuesto</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>SiEmailSentDecision</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>EmailSentQuestion</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Yes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>PantallaAvisoDescarguePresupuesto</targetReference>
            </connector>
            <label>Sí</label>
        </rules>
    </decisions>
    <decisions>
        <description>Si se ha marcado quieres contratar seguro o no</description>
        <name>InsuranceHireDecision</name>
        <label>¿Quiere Contratar Seguro?</label>
        <locationX>740</locationX>
        <locationY>638</locationY>
        <defaultConnector>
            <targetReference>Decision_QuiereLlamadaEnOtroMomento</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesInsuranceHire</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>InsuranceHireQuestion</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Yes</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CloseOppDecision</targetReference>
            </connector>
            <label>Sí</label>
        </rules>
    </decisions>
    <decisions>
        <name>Switch</name>
        <label>Switch</label>
        <locationX>1407</locationX>
        <locationY>158</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>SwitchOff</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Setup.SwitchesConfiguration__c.DesactiveFlowCampaignMember__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>TextosArgumentario</targetReference>
            </connector>
            <label>SwitchOff</label>
        </rules>
    </decisions>
    <description>Muestra opciones para marcar si se quiere contratar el seguro para cerrar la oportunidad (HEADER dinámico incorporado con imagen como recurso estático y texto con objeto textos de argumentario) Trata la salida del flujo y planificación de llamadas

09/09 NRG: Se añadió dependencia según medio a los motivos de perdida de Opp.
29/09 NRG: Añadido validación para email
29/09 AC: Cambio de preguntas por Textos Argumentario variables
11/10 MMV: Se añade el planificación de llamada si quiere que le llame en otro momento
18/10 NRG: Añadido consolidación de pantallas
20/10 AMT: Cambios en las cabeceras de las pantallas
28/11 MMV: Cambio para usar IsConverted en lugar de ConvertedContactId
10/02/2023 LCS-JCB: Inserción de enlace a Oportunidad Creada en pantalla</description>
    <dynamicChoiceSets>
        <description>Valores picklist para el campo motivo de perdida cuando el usuario es Agente</description>
        <name>Choice_MotivoPerdidaOppAgente</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>MotivoPerdidaOppAgente__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores del campo LossReason</description>
        <name>LossReasonPicklistChoiceSet</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Loss_Reason__c</picklistField>
        <picklistObject>Opportunity</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores para motivo de perdida cuando el medio es BBDD</description>
        <name>PicklistOppPerdidaBBDD</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>OppPerdidaSalientesBBDD__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores picklist para opp perdida para medio blecis</description>
        <name>PicklistOppPerdidaBlecis</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>OppPerdidaBlecis__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores picklist para motivo de perdida para entrantes básicos</description>
        <name>PicklistOppPerdidaEntrantesBasicos</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>OppPerdidaEntrantesBasicos__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores picklist para motivo de perdida cuando el medio es préstamos</description>
        <name>PicklistOppPerdidaPrestamos</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>OppPerdidPrestamos__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>Valores picklist para opp perdida para salientes basicos</description>
        <name>PicklistOppPerdidaSalientesBasicos</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>OppPerdidaSalientesBasicos__c</picklistField>
        <picklistObject>FlowPicklist__mdt</picklistObject>
    </dynamicChoiceSets>
    <formulas>
        <description>Fórmula para calcular el enlace para acceder a la oportunidad creada recientemente.</description>
        <name>Formula_EnlaceOportunidadCreada</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_550}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_550})) &amp; {!OpportunityVariable.Id}</expression>
    </formulas>
    <formulas>
        <description>Recogemos el valor de motivo de perdida de un screen u otro</description>
        <name>Formula_MotivoPerdidaPicklistResultado</name>
        <dataType>String</dataType>
        <expression>IF ( NOT( ISBLANK( TEXT( {!Choice_MotivoPerdidaOppAgente} ) ) ) , TEXT( {!Choice_MotivoPerdidaOppAgente} ), 
 IF ( NOT( ISBLANK( TEXT( {!PicklistOppPerdidaBBDD} ) ) ), TEXT( {!PicklistOppPerdidaBBDD} ),
 IF ( NOT( ISBLANK( TEXT( {!LossReasonPicklistChoiceSet} ) ) ), TEXT( {!LossReasonPicklistChoiceSet} ),
  IF( NOT( ISBLANK( TEXT( {!PicklistOppPerdidaBlecis} ) ) ), TEXT( {!PicklistOppPerdidaBlecis} ),
    IF ( NOT( ISBLANK( TEXT( {!PicklistOppPerdidaEntrantesBasicos} ) ) ), TEXT( {!PicklistOppPerdidaEntrantesBasicos} ),
     IF( NOT( ISBLANK( TEXT( {!PicklistOppPerdidaPrestamos} ) ) ), TEXT( {!PicklistOppPerdidaPrestamos} ),
      IF( NOT( ISBLANK( TEXT( {!PicklistOppPerdidaSalientesBasicos} ) ) ), TEXT( {!PicklistOppPerdidaSalientesBasicos} ), &quot;Error: No hay valor&quot;
      )
     )
    )
   )
 )
)
)</expression>
    </formulas>
    <formulas>
        <description>Comprobamos a través de regex que el email tiene el formato correcto</description>
        <name>Formula_ValidarEmail</name>
        <dataType>Boolean</dataType>
        <expression>REGEX( {!screenContactEmail.value} , &quot;^\\(([a-zA-Z0-9 _\\-\\.\\+]+)\\)\\ ([a-zA-Z0-9\n&quot; +
               &quot;_\\!\\#\\$\\%\\&amp;amp;\\&apos;\\*\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\\n&quot; +
                &quot;.[0-9]{1,3}\\.)|(([a-zA-Z0-9\\w\n&quot; +
                &quot;_\\!\\#\\$\\%\\&amp;amp;\\&apos;\\*\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3}\n&quot; +
                &quot;)$|^([a-zA-Z0-9 \\w\n&quot; +
                &quot;_\\!\\#\\$\\%\\&amp;amp;\\&apos;\\*\\-\\/\\=\\?\\^\\`\\{\\|\\}\\~\\.]+)@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\\n&quot; +
                &quot;.[0-9]{1,3}\\.)|(([a-zA-Z0-9_\\-]+\\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})$&quot;)</expression>
    </formulas>
    <interviewLabel>Subflujo Pantalla Contacto Quiere Contratar Seguro (Básicos) {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Subflujo Pantalla Contacto Quiere Contratar Seguro (Básicos)</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordLookups>
        <description>Buscamos si existe algún contacto en la bbdd con este email</description>
        <name>Get_ContactosDuplicados</name>
        <label>Get_ContactosDuplicados</label>
        <locationX>1414</locationX>
        <locationY>1358</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_LeadsDuplicados</targetReference>
        </connector>
        <filters>
            <field>Email</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>screenContactEmail.value</elementReference>
            </value>
        </filters>
        <filters>
            <field>Email</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>OpportunityVariable.Account.PersonContactId</elementReference>
            </value>
        </filters>
        <object>Contact</object>
    </recordLookups>
    <recordLookups>
        <description>Buscamos en Leads registros con el mismo email</description>
        <name>Get_LeadsDuplicados</name>
        <label>Get_LeadsDuplicados</label>
        <locationX>1414</locationX>
        <locationY>1478</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Decision_Hay_duplicados</targetReference>
        </connector>
        <filters>
            <field>Email</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>screenContactEmail.value</elementReference>
            </value>
        </filters>
        <filters>
            <field>Email</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>IsConverted</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>Lead</object>
    </recordLookups>
    <recordLookups>
        <description>Recuperamos el contacto relacionada con la oportunidad</description>
        <name>Recuperamos_el_Contact</name>
        <label>Recuperamos el Contact</label>
        <locationX>740</locationX>
        <locationY>398</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>InsuranceHire</targetReference>
        </connector>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>OpportunityVariable.Account.PersonContactId</elementReference>
            </value>
        </filters>
        <object>Contact</object>
    </recordLookups>
    <recordLookups>
        <description>Recoge los textos de Argumentario que se usan en las pantallas de ESTE Flujo</description>
        <name>TextosArgumentario</name>
        <label>TextosArgumentario</label>
        <locationX>740</locationX>
        <locationY>278</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Recuperamos_el_Contact</targetReference>
        </connector>
        <filters>
            <field>Flujo__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>SubflujoPantallaContactoQuiereContratarSeguroBasicos</stringValue>
            </value>
        </filters>
        <filters>
            <field>Idioma__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$User.LanguageLocaleKey</elementReference>
            </value>
        </filters>
        <object>TextoArgumentario__c</object>
    </recordLookups>
    <recordUpdates>
        <description>Actualizamos el contacto con el nuevo email</description>
        <name>ActualizamosContacto</name>
        <label>Actualizamos el Contacto</label>
        <locationX>1546</locationX>
        <locationY>1838</locationY>
        <connector>
            <targetReference>UpdateOpportunity</targetReference>
        </connector>
        <inputReference>Recuperamos_el_Contact</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>UpdateOpportunity</name>
        <label>Update opportunity</label>
        <locationX>1100</locationX>
        <locationY>2342</locationY>
        <connector>
            <targetReference>SetMostrarIntereses</targetReference>
        </connector>
        <inputReference>OpportunityVariable</inputReference>
    </recordUpdates>
    <screens>
        <name>InsuranceHire</name>
        <label>Pantalla Contratar Seguro</label>
        <locationX>740</locationX>
        <locationY>518</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>InsuranceHireDecision</targetReference>
        </connector>
        <fields>
            <name>S01_Header</name>
            <extensionName>dhfpi:lwcFlowHeaderWithProgress</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>heading</name>
                <value>
                    <elementReference>Var_INOUT_Heading</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>currentStage</name>
                <value>
                    <elementReference>$Flow.CurrentStage</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>iconSize</name>
                <value>
                    <stringValue>small</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>fontSize</name>
                <value>
                    <stringValue>12</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>icon</name>
                <value>
                    <elementReference>Var_INOUT_HeadingIcon</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>stages</name>
                <value>
                    <elementReference>$Flow.ActiveStages</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>subHeading</name>
                <value>
                    <elementReference>Var_INOUT_SubHeading</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>enlaceOportunidadCreada</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68); font-size: 16px;&quot;&gt;Oportunidad creada: &lt;/span&gt;&lt;a href=&quot;{!Formula_EnlaceOportunidadCreada}&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; style=&quot;background-color: rgb(255, 255, 255); color: rgb(16, 12, 199); font-size: 16px;&quot;&gt;&lt;strong&gt;{!OpportunityVariable.Name}&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>InsuranceHireQuestion</name>
            <choiceReferences>Yes</choiceReferences>
            <choiceReferences>No</choiceReferences>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>Var_EntradaInsuranceHireQuestion</elementReference>
            </defaultValue>
            <fieldText>{!TextosArgumentario.Etiqueta1__c}</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>PreguntaQuiereLlamadaEnOtroMomento</name>
            <choiceReferences>Yes</choiceReferences>
            <choiceReferences>No</choiceReferences>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>Var_EntradaLLamarOtroMomento</elementReference>
            </defaultValue>
            <fieldText>{!TextosArgumentario.Etiqueta4__c}</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>CloseOppQuestion</name>
            <choiceReferences>Yes</choiceReferences>
            <choiceReferences>No</choiceReferences>
            <dataType>String</dataType>
            <fieldText>{!TextosArgumentario.Etiqueta2__c}</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>EmailSentQuestion</name>
            <choiceReferences>Yes</choiceReferences>
            <choiceReferences>No</choiceReferences>
            <dataType>String</dataType>
            <fieldText>{!TextosArgumentario.Etiqueta3__c}</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>ScreenLossReasonAgente</name>
            <choiceReferences>Choice_MotivoPerdidaOppAgente</choiceReferences>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>Var_EntradaMotivoPerdida</elementReference>
            </defaultValue>
            <fieldText>Motivo de perdida</fieldText>
            <fieldType>DropdownBox</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>InsuranceHire_Section1</name>
            <fieldType>RegionContainer</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>InsuranceHire_Section2</name>
            <fieldType>RegionContainer</fieldType>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>PantallaAvisoDescarguePresupuesto</name>
        <label>Pantalla Aviso Descargue Presupuesto</label>
        <locationX>50</locationX>
        <locationY>998</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>MarcaInteresExlucido</targetReference>
        </connector>
        <fields>
            <name>S02_Header</name>
            <extensionName>dhfpi:lwcFlowHeaderWithProgress</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>heading</name>
                <value>
                    <elementReference>Var_INOUT_Heading</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>currentStage</name>
                <value>
                    <elementReference>$Flow.CurrentStage</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>iconSize</name>
                <value>
                    <stringValue>small</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>fontSize</name>
                <value>
                    <stringValue>12</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>icon</name>
                <value>
                    <elementReference>Var_INOUT_HeadingIcon</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>stages</name>
                <value>
                    <elementReference>$Flow.ActiveStages</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>subHeading</name>
                <value>
                    <elementReference>Var_INOUT_SubHeading</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>AvisoDescarguePresupuestoYMas</name>
            <fieldText>&lt;p&gt;{!TextosArgumentario.Texto5__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>ReviseDatosTarificacion</name>
            <fieldText>&lt;p&gt;{!TextosArgumentario.Texto6__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>PantallaAvisoPresupuesto</name>
        <label>Pantalla Aviso Presupuesto</label>
        <locationX>314</locationX>
        <locationY>998</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>MarcaInteresExlucido</targetReference>
        </connector>
        <fields>
            <name>S03_Header</name>
            <extensionName>dhfpi:lwcFlowHeaderWithProgress</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>heading</name>
                <value>
                    <elementReference>Var_INOUT_Heading</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>currentStage</name>
                <value>
                    <elementReference>$Flow.CurrentStage</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>iconSize</name>
                <value>
                    <stringValue>small</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>fontSize</name>
                <value>
                    <stringValue>12</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>icon</name>
                <value>
                    <elementReference>Var_INOUT_HeadingIcon</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>stages</name>
                <value>
                    <elementReference>$Flow.ActiveStages</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>subHeading</name>
                <value>
                    <elementReference>Var_INOUT_SubHeading</elementReference>
                </value>
            </inputParameters>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>AvisoDescarguePresupuesto</name>
            <fieldText>&lt;p&gt;{!TextosArgumentario.Texto7__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>RevisionDatosTarificacion</name>
            <fieldText>&lt;p&gt;{!TextosArgumentario.Texto8__c}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <startElementReference>Switch</startElementReference>
    <status>Active</status>
    <subflows>
        <description>Argumentario_Subflow_OppMotivoAplazamiento</description>
        <name>Argumentario_Subflow_OppMotivoAplazamiento</name>
        <label>Argumentario_Subflow_OppMotivoAplazamiento</label>
        <locationX>842</locationX>
        <locationY>878</locationY>
        <connector>
            <targetReference>Set_PlanificarLlamada</targetReference>
        </connector>
        <flowName>Argumentario_Subflow_OppMotivoAplazamiento</flowName>
        <inputAssignments>
            <name>Var_INOUT_Heading</name>
            <value>
                <elementReference>Var_INOUT_Heading</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_HeadingIcon</name>
            <value>
                <elementReference>Var_INOUT_HeadingIcon</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_Opportunity</name>
            <value>
                <elementReference>OpportunityVariable</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_SubHeading</name>
            <value>
                <elementReference>Var_INOUT_SubHeading</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_Heading</assignToReference>
            <name>Var_INOUT_Heading</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_HeadingIcon</assignToReference>
            <name>Var_INOUT_HeadingIcon</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>OpportunityVariable</assignToReference>
            <name>Var_INOUT_Opportunity</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_SubHeading</assignToReference>
            <name>Var_INOUT_SubHeading</name>
        </outputAssignments>
    </subflows>
    <subflows>
        <name>PlanificacionLlamada</name>
        <label>Planificación de Llamada</label>
        <locationX>578</locationX>
        <locationY>878</locationY>
        <connector>
            <targetReference>MarcaPlanificarLlamada</targetReference>
        </connector>
        <flowName>SubflujoPantallaPlanificacionLlamada</flowName>
        <inputAssignments>
            <name>CTICMVariable</name>
            <value>
                <elementReference>CTICampaignMember</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_Heading</name>
            <value>
                <elementReference>Var_INOUT_Heading</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_HeadingIcon</name>
            <value>
                <elementReference>Var_INOUT_HeadingIcon</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>Var_INOUT_SubHeading</name>
            <value>
                <elementReference>Var_INOUT_SubHeading</elementReference>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_Heading</assignToReference>
            <name>Var_INOUT_Heading</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_HeadingIcon</assignToReference>
            <name>Var_INOUT_HeadingIcon</name>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>Var_INOUT_SubHeading</assignToReference>
            <name>Var_INOUT_SubHeading</name>
        </outputAssignments>
    </subflows>
    <variables>
        <name>CTICampaignMember</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>CampaignMember</objectType>
    </variables>
    <variables>
        <description>ID de intereses excluidos (tratado en este flujo) para filtrar los Intereses obtenidos (CM, CMAG y OPP). Este parámetro de salida en este flujo devuelve el interés que se haya tratado</description>
        <name>InteresExcluido</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>MostrarIntereses</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <name>OpportunityVariable</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Opportunity</objectType>
    </variables>
    <variables>
        <description>Variable que controla que se muestre o no el planificador de llamada cuando se cierra el argumentario. Es de salida puesto que el flujo principal debe controlar que se haya indicado la planificación.</description>
        <name>PlanificarLlamada</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Almacena el valor del campo email</description>
        <name>Var_EntradaEmail</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Almacena el valor de la pregunta InsuranceHireQuestion</description>
        <name>Var_EntradaInsuranceHireQuestion</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Almacena el valor de la pregunta PreguntaQuiereLlamadaEnOtroMomento</description>
        <name>Var_EntradaLLamarOtroMomento</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Almacena el valor seleccionado en el screen para motivo de perdida</description>
        <name>Var_EntradaMotivoPerdida</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Texto de cabecera que se utiliza además como parámetro de entrada en todos los subflujos y que se muestra en todas las pantallas. Es siempre Available for Input y Output. Es el nombre de la persona con la que estamos hablando y que vendrá del lead o del contacto.</description>
        <name>Var_INOUT_Heading</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Imagen de cabecera que se utiliza además como parámetro de entrada en todos los subflujos y que se muestra en todas las pantallas. Es siempre Available for Input y Output. Es el ícono que se muestra en la cabecera.</description>
        <name>Var_INOUT_HeadingIcon</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Texto de subcabecera que se utiliza además como parámetro de entrada en todos los subflujos y que se muestra en todas las pantallas. Es siempre Available for Input y Output. Es el el interés (Ramo) que se está tratando en ese momento y que depende de dónde provenga el interés.</description>
        <name>Var_INOUT_SubHeading</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Indica si debe mostrarse el mensaje de error para email duplicado</description>
        <name>Var_MostrarErrorEmailDuplicado</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Indica si debe mostrarse el mensaje de error para validacion de email</description>
        <name>Var_MostrarErrorValidacion</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Variable para guardar el rol de usuario</description>
        <name>Var_UserRole</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <elementReference>$UserRole.Name</elementReference>
        </value>
    </variables>
</Flow>
